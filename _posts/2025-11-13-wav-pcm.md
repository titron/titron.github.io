---
layout: post
title:  "audio系统中，WAV和PCM的关系和区别"
categories: basic
tags: audio, AAC-LC，wav, pcm
author: David
---

* content
{:toc}

---
[WAV和PCM的关系和区别](https://zhuanlan.zhihu.com/p/518831885)

wav是一种无损的音频文件格式，WAV符合 PIFF(Resource Interchange File Format)规范。
所有的WAV都有一个文件头，这个文件头音频流的编码参数。
WAV对音频流的编码没有硬性规定，除了PCM之外，还有几乎所有支持ACM规范的编码都可以为WAV的音频流进行编码。
缺点：体积十分大！

PCM（Pulse Code Modulation----脉码调制录音)。
所谓PCM录音就是将声音等模拟信号变成符号化的脉冲列，再予以记录。
PCM信号是由“1”、“0”等符号构成的数字信号，而*未经过任何编码和压缩处理*。
与模拟信号比，它不易受传送系统的杂波及失真的影响。动态范围宽，可得到音质相当好的影响效果。

*简单来说：wav是一种无损的音频文件格式，pcm是没有压缩的编码方式。*


WAV可以使用多种音频编码来压缩其音频流，不过我们常见的都是音频流被PCM编码处理的WAV，但这不表示WAV只能使用PCM编码，MP3编码同样也可以运用在WAV中。
基于PCM编码的WAV被作为了一种中介的格式，常常使用在其他编码的相互转换之中，例如MP3转换成WMA。

*简单来说：pcm是无损wav文件中音频数据的一种编码方式，但wav还可以用其它方式编码。*
## wav文件格式
在文件的前44字节放置标头(header)，使播放器或编辑器能够简单掌握文件的基本信息，其内容以区块(chunk)为最小单位，每一区块长度为4字节。
![wav header](https://github.com/titron/titron.github.io/raw/master/img/2025-11-13-wav_pcm_wav_header.jpg)


## 将录音写成wav格式的文件
```c
// 将录音文件保存为wav格式，这需要手动填充wav的文件头信息
private RandomAccessFile fopen(String path) throws IOException {
    File f = new File(path);

    if (f.exists()) {
        f.delete();
    } else {
        File parentDir = f.getParentFile();
        if (!parentDir.exists()) {
            parentDir.mkdirs();
        }
    }

    RandomAccessFile file = new RandomAccessFile(f, "rw");
    // 16K、16bit、单声道
    /* RIFF header */
    file.writeBytes("RIFF"); // riff id
    file.writeInt(0); // riff chunk size *PLACEHOLDER*
    file.writeBytes("WAVE"); // wave type

    /* fmt chunk */
    file.writeBytes("fmt "); // fmt id
    file.writeInt(Integer.reverseBytes(16)); // fmt chunk size
    file.writeShort(Short.reverseBytes((short) 1)); // format: 1(PCM)
    file.writeShort(Short.reverseBytes((short) 1)); // channels: 1
    file.writeInt(Integer.reverseBytes(16000)); // samples per second
    file.writeInt(Integer.reverseBytes((int) (1 * 16000 * 16 / 8))); // BPSecond
    file.writeShort(Short.reverseBytes((short) (1 * 16 / 8))); // BPSample
    file.writeShort(Short.reverseBytes((short) (1 * 16))); // bPSample

    /* data chunk */
    file.writeBytes("data"); // data id
    file.writeInt(0); // data chunk size *PLACEHOLDER*

    Log.d(TAG, "wav path: " + path);
    return file;
}

private void fwrite(RandomAccessFile file, byte[] data, int offset, int size) throws IOException {
    file.write(data, offset, size);
    Log.d(TAG, "fwrite: " + size);
}

private void fclose(RandomAccessFile file) throws IOException {
    try {
        file.seek(4); // riff chunk size
        file.writeInt(Integer.reverseBytes((int) (file.length() - 8)));

        file.seek(40); // data chunk size
        file.writeInt(Integer.reverseBytes((int) (file.length() - 44)));

        Log.d(TAG, "wav size: " + file.length());

    } finally {
        file.close();
    }
}
```

## wav转pcm
```python
# 将文件头去掉，数据转成int型即可
import numpy as np
def wav2pcm(wavfile, pcmfile, data_type=np.int16):
    f = open(wavfile, "rb")
    f.seek(0)
    f.read(44)
    data = np.fromfile(f, dtype= data_type)
    data.tofile(pcmfile)
```
## pcm转wav
```python
# 利用wave库，添加通道信息、采样位数、采样率等信息作为文件头，pcm数据直接写入即可
import wave
def pcm2wav(pcm_file, wav_file, channels=1, bits=16, sample_rate=16000):
    pcmf = open(pcm_file, 'rb')
    pcmdata = pcmf.read()
    pcmf.close()
 
    if bits % 8 != 0:
        raise ValueError("bits % 8 must == 0. now bits:" + str(bits))
 
    wavfile = wave.open(wav_file, 'wb')
    wavfile.setnchannels(channels)
    wavfile.setsampwidth(bits // 8)
    wavfile.setframerate(sample_rate)
    wavfile.writeframes(pcmdata)
    wavfile.close()
```